# Maintainer: haui2 <haui@gifted-minecraft.com>
pkgname=u-boot-spacemit-kx107
pkgver=2024.12
pkgrel=0
pkgdesc="u-boot bootloader for kx107 (dc-roma-pad-ii)"
url="https://forge.giftedmc.com/haui/u-boot.git"
arch="riscv64"
license="GPL-2.0-or-later OFL-1.1 BSD-2-Clause BSD-3-Clause eCos-2.0 IBM-pibs
	ISC LGPL-2.0-only LGPL-2.1-only X11"
makedepends="$depends_dev py3-setuptools bc dtc python3-dev swig bison flex openssl-dev opensbi"
options="!check"
source="
	spacemit-u-boot-2022.10-k1.zip::https://github.com/orangecms/spacemit-u-boot/archive/refs/heads/v2022.10-k1.zip
"
	# u-boot.tar.gz::https://forge.giftedmc.com/haui/u-boot/archive/bl-v1.0.y.tar.gz

# builddir="$srcdir"/u-boot
builddir="$srcdir"/spacemit-u-boot-2022.10-k1
build() {
	ls -al
	touch include/config.h
	LC_ALL=C date +'#define U_BOOT_DATE "%b %d %C%y"' > include/timestamp_autogenerated.h
	LC_ALL=C date +'#define U_BOOT_TIME "%T"' >> include/timestamp_autogenerated.h

	export OPENSBI="/usr/share/opensbi/generic/firmware/fw_dynamic.bin"
	export BUILD_DIR="$builddir"/build
	mkdir -p "$BUILD_DIR"
	make O="$BUILD_DIR" HOSTCC=gcc ARCH=riscv k1_defconfig
	make O="$BUILD_DIR" HOSTCC=gcc ARCH=riscv all
}

package() {
echo "packaging... test"
}

sha512sums="
eeb542a823f2f7e5fed95eab01ed3d3d3085fe68dbad6aee7856588590b4c9849dc134c79d599da0d1fd57ae6482925361ffb7590993a8adb3789eaec7a97591  spacemit-u-boot-2022.10-k1.zip
"
