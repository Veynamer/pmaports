From 8de99a344fe0c3018672277af4654efa878bb9af Mon Sep 17 00:00:00 2001
From: Jane Rachinger <jane400@postmarketos.org>
Date: Sun, 25 May 2025 15:36:49 +0200
Subject: [PATCH 4/5] gsk: Drop GskProfiler in gskcairorenderer

This partially reapplies commit 5ef5b7be2d841c8ae7662038d528804c952359cb.
---
 gsk/gskcairorenderer.c | 31 ++-----------------------------
 1 file changed, 2 insertions(+), 29 deletions(-)

diff --git a/gsk/gskcairorenderer.c b/gsk/gskcairorenderer.c
index da3ffa94db..b78e3e32b9 100644
--- a/gsk/gskcairorenderer.c
+++ b/gsk/gskcairorenderer.c
@@ -74,27 +74,6 @@ gsk_cairo_renderer_unrealize (GskRenderer *renderer)
   g_clear_object (&self->cairo_context);
 }
 
-static void
-gsk_cairo_renderer_do_render (GskRenderer   *renderer,
-                              cairo_t       *cr,
-                              GdkColorState *ccs,
-                              GskRenderNode *root)
-{
-  GskCairoRenderer *self = GSK_CAIRO_RENDERER (renderer);
-  GskProfiler *profiler;
-  gint64 cpu_time;
-
-  profiler = gsk_renderer_get_profiler (renderer);
-  gsk_profiler_timer_begin (profiler, self->profile_timers.cpu_time);
-
-  gsk_render_node_draw_with_color_state (root, cr, ccs);
-
-  cpu_time = gsk_profiler_timer_end (profiler, self->profile_timers.cpu_time);
-  gsk_profiler_timer_set (profiler, self->profile_timers.cpu_time, cpu_time);
-
-  gsk_profiler_push_samples (profiler);
-}
-
 static GdkTexture *
 gsk_cairo_renderer_render_texture (GskRenderer           *renderer,
                                    GskRenderNode         *root,
@@ -145,7 +124,7 @@ gsk_cairo_renderer_render_texture (GskRenderer           *renderer,
 
   cairo_translate (cr, - viewport->origin.x, - viewport->origin.y);
 
-  gsk_cairo_renderer_do_render (renderer, cr, GDK_COLOR_STATE_SRGB, root);
+  gsk_render_node_draw_with_color_state (root, cr, GDK_COLOR_STATE_SRGB);
 
   cairo_destroy (cr);
 
@@ -193,10 +172,7 @@ G_GNUC_END_IGNORE_DEPRECATIONS
       cairo_restore (cr);
     }
 
-  gsk_cairo_renderer_do_render (renderer,
-                                cr,
-                                gdk_draw_context_get_color_state (GDK_DRAW_CONTEXT (self->cairo_context)),
-                                root);
+  gsk_render_node_draw_with_color_state (root, cr, gdk_draw_context_get_color_state (GDK_DRAW_CONTEXT (self->cairo_context)));
 
   cairo_destroy (cr);
 
@@ -217,9 +193,6 @@ gsk_cairo_renderer_class_init (GskCairoRendererClass *klass)
 static void
 gsk_cairo_renderer_init (GskCairoRenderer *self)
 {
-  GskProfiler *profiler = gsk_renderer_get_profiler (GSK_RENDERER (self));
-
-  self->profile_timers.cpu_time = gsk_profiler_add_timer (profiler, "cpu-time", "CPU time", FALSE, TRUE);
 }
 
 /**
-- 
2.49.0

